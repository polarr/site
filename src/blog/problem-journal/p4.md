---
title: Problem Solving Journal 4
description: ''
date: '2025-12-23'
categories:
  - problem-journal
  - math
  - cs
  - algorithms
problems:
  - 'Modular Tetration'
  - '1-Regular Subgraphs of 2-Regular Directed Graphs'
  - 'Propagation Queries on Trees, Revisited'
published: true
journalOnly: false
---

<script>
    import { Blockquote, Img, Span, P, A } from "flowbite-svelte";
</script>

I find the intro of these so-called problem solving journals a great place to ramble about life :)

Some good and bad things happened this fall. 

In November I made it onto the ICPC team and we placed 3rd in the regionals to qualify for the North American Championships (NAC). It was a pretty fun experience and we were doing really well, ranking 1st for most of the competition until we trolled in the last hour. Of the two problems we didn't solve, we sadly misread one and overthought the other. Overall it was still a decent showing and I'm excited for the NAC in March.

I managed to oversleep for the Putnam (they host it 8am here on a Saturday!), but it didn't really matter anyways as I barely practiced.

Sadly the only professor here who specializes in Analytic NT retired mid-term... right when I was about to contact him for a research project. Too bad. I'm also starting my first job search soon, hopefully I can actually land something decent...

Now onto some problems...

## Modular Tetration

> For a positive integer a, we define a recurrence $\{b_n\}$ as $b_n=a^{b_{nâˆ’1}}$, with $b_0=1$.
> 
> We say that a positive integer $a$ is $m$-tetrative if the sequence $b$ stabilizes to 1 modulo $m$, that is, there exists $N \geq 0$ such that $b_n \equiv 1 \pmod{m}$ for all $n \geq N$.
> 
> For a given $m$, calculate the density of the $m$-tetrative integers. $m \leq 10^{18}$ is given as a product of integers $m = xyz$, where $x, y, z \leq 10^6$.
> 
> Here, the density of a set $S$ is the limit $\lim_{n \to \infty} \frac{|S \cap [1, 2, \dots, n]|}{n}$. Informally, it is the "proportion" of positive integers that are $m$-tetrative. 
>
> You should find this in $\mathcal{O}(\text{polylog } m)$ time.
> 
> --Source: [Codeforces 2147G](https://codeforces.com/problemset/problem/2147/G)

### Solution

First we do some number theory to characterize the $m$-tetrative integers.

Consider the convergence of $b_n \pmod m$. We require

$$
\begin{cases}
b_n \equiv 1 \pmod m \\
b_{n + 1} = a^{b_n} \equiv 1 \pmod m \implies b_n \equiv 0 \pmod{\text{ord}_m(a)}
\end{cases}
$$

This means that $\gcd(m, \text{ord}_m(a)) = 1$, and $\text{rad } \text{ord}_m(a) \mid a$, where $\text{rad}$ is the radical. Of course, we also require $\gcd(a, m) = 1$. We can see that these three conditions are necessary, but actually also sufficient. The tetration process guarantees that $b_n$ eventually converges to $0 \pmod{\text{ord}_m(a)}$, at which point $b_n \equiv 1 \pmod m$ is guaranteed.

That was the easy part, now we try to find the density of $m$-tetrative integers. Let us fix $k = \text{rad } \text{ord}_m(a)$, and then if some $a$ is $m$-tetrative with order radical $k$, then $k \mid a$. But $k \mid a + tm \iff k \mid t$. So considering $a \mod m$, the densitiy of this equvalence class is $1/k$. Therefore, we are looking to find

$$
\sum_k \frac{\text{count}(k)}{k}
$$

Where $\text{count }{k}$ is the number of residues with $\text{rad } \text{ord}_m(a) = k$.

#### CRT Decomposition

First let's try this using Chinese Remainder Theorem (CRT) decomposition to enumerate $\text{count}(k)$. Write $s = \text{ord}_m(a)$. We know that given $m = \prod p_i^{\alpha_i}$, since $\gcd(m, s) = 1$ and $s \mid \phi(m)$ it must be the case that $s \mid \prod (p_i - 1)$. We can decompose $s = \prod s_i$ where $s_i \mid p_i - 1$. However, we can enforce $s_i = \text{ord}_{p_i^{\alpha_i}}(a)$, since $\text{ord}_{p_i^{\alpha_i}}(a) \mid \phi(p_i^{\alpha_i})$. 

Then the question is, how many $a \mod p_i^{\alpha_i}$ have order $s_i$? The answer is $\phi(s_i)$. This is trivial for $p_i = 2$, and for other primes we note that $(\mathbb{Z}/p_i^{\alpha_i}\mathbb{Z})^{\times}$ is cyclic, so it follows by considering powers of a primitive root. Therefore, this $s_i$ contributes $\frac{\phi(s_i)}{\text{rad } s_i}$. We can do this for each $s_i$, and take a direct product by combining 
$$
\frac{\phi(s_i)}{\text{rad } s_i} \circ \frac{\phi(s_j)}{\text{rad } s_j} = \frac{\phi(s_i) \cdot \phi(s_j)}{\text{lcm}(\text{rad } s_i, \text{rad } s_j)}
$$
The denominator gets the new radical of the new order $s$ of each $a$ from the CRT. Done correctly this is a $O(\prod d(s_i))$ solution, which we know can be $o((\text{rad } m)^{\epsilon})$, but in practice computing and storing the direct sums can take a lot of memory.

#### Sylow Decomposition

We can try to a different way of resolving $\text{count }{k}$. Two important facts from group theory are helpful here. Consider the unique Sylow $p$-subgroups $\text{Syl}_p$ of $(\mathbb{Z}/m \mathbb{Z})^{\times}$, which is finite abelian:

$$
(\mathbb{Z}/m \mathbb{Z})^{\times} = \bigoplus_{p} {\text{Syl}_p}
$$

This is a well known fact for finite abelian groups. Moreover, if $p \mid \text{ord } g$ if and only if the component of $\text{Syl}_{p}$ is nonzero. This is extremely useful here, because we now note that we can instead consider the count over subsets of $k = \prod q_j$ for $\phi(m) = \prod q_i^{\beta_i}$. 

$$
\sum_{d \mid k} \text{count }d = \left| \prod \text{Syl}_{q_j} \right| = \prod \left| \text{Syl}_{q_j} \right| = \prod q_j^{\beta_j}
$$

What's left is to recover $\text{count } k$, which is an immediate application of mobius inversion. In fact at this point we know we are done since the set of multiplicative functions is a group under Dirichlet convolution. We therefore must obtain a multiplicative function, so we can easily calculate it after a prime sieve.

$$
\text{count} * 1 = \prod q_j^{\beta_j} \implies \text{count} = \prod q_j^{\beta_j} * \mu
$$

$$
\text{count}(k) = \prod (q_j^{\beta_j} - 1)
$$

And since the possible $k$ is a set of divisors, iterating over possible $k$ we also get something nice.

$$
\sum_{\substack{k \mid \text{rad} \phi(m) \\ \gcd(k, m) = 1}} \frac{\text{count}(k)}{k} = \prod_{q_j \mid K} \left( 1 + \frac{q_j^{\beta_j} - 1}{q_j} \right)
$$

Where $K = \text{rad } \phi(m)/\gcd(\text{rad } \phi(m),\text{rad } m)$. Of course we can prime sieve this and then compute the answer in $\mathcal{O}(\text{polylog } m).$$\blacksquare$

This is the first time I really got the chance to use abstract algebra on a CP problem and was also my first LGM (3000+) rating solve!!!